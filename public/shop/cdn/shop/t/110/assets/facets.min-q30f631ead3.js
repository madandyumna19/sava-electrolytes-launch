class FacetFiltersForm extends HTMLElement{constructor(){super();this.onActiveFilterClick=this.onActiveFilterClick.bind(this);this.debouncedOnSubmit=debounce(b=>{this.onSubmitHandler(b)},500);this.querySelector("form").addEventListener("input",this.debouncedOnSubmit.bind(this));const a=this.querySelector("#FacetsWrapperDesktop");a&&a.addEventListener("keyup",onKeyUpEscape)}static setListeners(){window.addEventListener("popstate",a=>{a=a.state?a.state.searchParams:FacetFiltersForm.searchParamsInitial;
a!==FacetFiltersForm.searchParamsPrev&&FacetFiltersForm.renderPage(a,null,!1)})}static toggleActiveFacets(a=!0){document.querySelectorAll(".js-facet-remove").forEach(b=>{b.classList.toggle("disabled",a)})}static renderPage(a,b,c=!0){FacetFiltersForm.searchParamsPrev=a;const f=FacetFiltersForm.getSections(),d=document.getElementById("ProductCount"),e=document.getElementById("ProductCountDesktop");document.getElementById("ProductGridContainer").querySelector(".collection").classList.add("loading");
d&&d.classList.add("loading");e&&e.classList.add("loading");f.forEach(g=>{const h=`${window.location.pathname}?section_id=${g.section}&${a}`;g=k=>k.url===h;FacetFiltersForm.filterData.some(g)?FacetFiltersForm.renderSectionFromCache(g,b):FacetFiltersForm.renderSectionFromFetch(h,b)});c&&FacetFiltersForm.updateURLHash(a)}static renderSectionFromFetch(a,b){fetch(a).then(c=>c.text()).then(c=>{FacetFiltersForm.filterData=[...FacetFiltersForm.filterData,{html:c,url:a}];FacetFiltersForm.renderFilters(c,
b);FacetFiltersForm.renderProductGridContainer(c);FacetFiltersForm.renderProductCount(c);"function"===typeof initializeScrollAnimationTrigger&&initializeScrollAnimationTrigger(c.innerHTML)})}static renderSectionFromCache(a,b){a=FacetFiltersForm.filterData.find(a).html;FacetFiltersForm.renderFilters(a,b);FacetFiltersForm.renderProductGridContainer(a);FacetFiltersForm.renderProductCount(a);"function"===typeof initializeScrollAnimationTrigger&&initializeScrollAnimationTrigger(a.innerHTML)}static renderProductGridContainer(a){document.getElementById("ProductGridContainer").innerHTML=
(new DOMParser).parseFromString(a,"text/html").getElementById("ProductGridContainer").innerHTML;document.getElementById("ProductGridContainer").querySelectorAll(".scroll-trigger").forEach(b=>{b.classList.add("scroll-trigger--cancel")})}static renderProductCount(a){a=(new DOMParser).parseFromString(a,"text/html").getElementById("ProductCount").innerHTML;const b=document.getElementById("ProductCount"),c=document.getElementById("ProductCountDesktop");b.innerHTML=a;b.classList.remove("loading");c&&(c.innerHTML=
a,c.classList.remove("loading"))}static renderFilters(a,b){a=(new DOMParser).parseFromString(a,"text/html");var c=a.querySelectorAll("#FacetFiltersForm .js-filter, #FacetFiltersFormMobile .js-filter, #FacetFiltersPillsForm .js-filter");const f=e=>{const g=b?b.target.closest(".js-filter"):void 0;return g?e.dataset.index===g.dataset.index:!1},d=Array.from(c).filter(e=>!f(e));c=Array.from(c).find(f);d.forEach(e=>{document.querySelector(`.js-filter[data-index="${e.dataset.index}"]`).innerHTML=e.innerHTML});
FacetFiltersForm.renderActiveFacets(a);FacetFiltersForm.renderAdditionalElements(a);c&&FacetFiltersForm.renderCounts(c,b.target.closest(".js-filter"))}static renderActiveFacets(a){[".active-facets-mobile",".active-facets-desktop"].forEach(b=>{const c=a.querySelector(b);c&&(document.querySelector(b).innerHTML=c.innerHTML)});FacetFiltersForm.toggleActiveFacets(!1)}static renderAdditionalElements(a){[".mobile-facets__open",".mobile-facets__count",".sorting"].forEach(b=>{a.querySelector(b)&&(document.querySelector(b).innerHTML=
a.querySelector(b).innerHTML)});document.getElementById("FacetFiltersFormMobile").closest("menu-drawer").bindEvents()}static renderCounts(a,b){const c=b.querySelector(".facets__selected"),f=a.querySelector(".facets__selected"),d=b.querySelector(".facets__summary"),e=a.querySelector(".facets__summary");f&&c&&(b.querySelector(".facets__selected").outerHTML=a.querySelector(".facets__selected").outerHTML);d&&e&&(b.querySelector(".facets__summary").outerHTML=a.querySelector(".facets__summary").outerHTML)}static updateURLHash(a){history.pushState({searchParams:a},
"",`${window.location.pathname}${a&&"?".concat(a)}`)}static getSections(){return[{section:document.getElementById("product-grid").dataset.id}]}createSearchParams(a){a=new FormData(a);return(new URLSearchParams(a)).toString()}onSubmitForm(a,b){FacetFiltersForm.renderPage(a,b)}onSubmitHandler(a){a.preventDefault();var b=document.querySelectorAll("facet-filters-form form");if("mobile-facets__checkbox"==a.srcElement.className)b=this.createSearchParams(a.target.closest("form")),this.onSubmitForm(b,a);
else{const c=[],f="FacetFiltersFormMobile"===a.target.closest("form").id;b.forEach(d=>{if(f)"FacetFiltersFormMobile"===d.id&&c.push(this.createSearchParams(d));else if("FacetSortForm"===d.id||"FacetFiltersForm"===d.id||"FacetSortDrawerForm"===d.id)document.querySelectorAll(".no-js-list").forEach(e=>e.remove()),c.push(this.createSearchParams(d))});this.onSubmitForm(c.join("&"),a)}}onActiveFilterClick(a){a.preventDefault();FacetFiltersForm.toggleActiveFacets();a=-1==a.currentTarget.href.indexOf("?")?
"":a.currentTarget.href.slice(a.currentTarget.href.indexOf("?")+1);FacetFiltersForm.renderPage(a)}}FacetFiltersForm.filterData=[];FacetFiltersForm.searchParamsInitial=window.location.search.slice(1);FacetFiltersForm.searchParamsPrev=window.location.search.slice(1);customElements.define("facet-filters-form",FacetFiltersForm);FacetFiltersForm.setListeners();
class PriceRange extends HTMLElement{constructor(){super();this.querySelectorAll("input").forEach(a=>a.addEventListener("change",this.onRangeChange.bind(this)));this.setMinAndMaxValues()}onRangeChange(a){this.adjustToValidValues(a.currentTarget);this.setMinAndMaxValues()}setMinAndMaxValues(){var a=this.querySelectorAll("input");const b=a[0];a=a[1];a.value&&b.setAttribute("max",a.value);b.value&&a.setAttribute("min",b.value);""===b.value&&a.setAttribute("min",0);""===a.value&&b.setAttribute("max",
a.getAttribute("max"))}adjustToValidValues(a){const b=Number(a.value),c=Number(a.getAttribute("min")),f=Number(a.getAttribute("max"));b<c&&(a.value=c);b>f&&(a.value=f)}}customElements.define("price-range",PriceRange);
class FacetRemove extends HTMLElement{constructor(){super();const a=this.querySelector("a");a.setAttribute("role","button");a.addEventListener("click",this.closeFilter.bind(this));a.addEventListener("keyup",b=>{b.preventDefault();"SPACE"===b.code.toUpperCase()&&this.closeFilter(b)})}closeFilter(a){a.preventDefault();(this.closest("facet-filters-form")||document.querySelector("facet-filters-form")).onActiveFilterClick(a)}}customElements.define("facet-remove",FacetRemove);
